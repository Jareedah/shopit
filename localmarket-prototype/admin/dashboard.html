<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - LocalMarket</title>
    <link rel="stylesheet" href="../assets/css/base/reset.css">
    <link rel="stylesheet" href="../assets/css/base/variables.css">
    <link rel="stylesheet" href="../assets/css/base/typography.css">
    <link rel="stylesheet" href="../assets/css/layout/header.css">
    <link rel="stylesheet" href="../assets/css/components/buttons.css">
    <link rel="stylesheet" href="../assets/css/components/forms.css">
    <link rel="stylesheet" href="../assets/css/components/cards.css">
    <link rel="stylesheet" href="../assets/css/pages/admin.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo">LocalMarket</h1>
            <nav class="navigation">
                <span class="nav-user">Admin Panel</span>
                <a href="../dashboard/index.html" class="nav-link">User Dashboard</a>
                <a href="../index.html" class="nav-link">Home</a>
                <span id="userWelcome"></span>
                <a href="#" id="logoutLink" class="nav-link">Logout</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="admin-header">
                <h2>Administrator Dashboard</h2>
                <p>System overview and management tools</p>
            </div>

            <div class="admin-nav">
                <button class="nav-btn active" data-tab="overview">Overview</button>
                <button class="nav-btn" data-tab="users">User Management</button>
                <button class="nav-btn" data-tab="listings">Listing Moderation</button>
                <button class="nav-btn" data-tab="analytics">Analytics</button>
                <button class="nav-btn" data-tab="settings">Settings</button>
            </div>

            <div class="admin-content">
                <!-- Overview Tab -->
                <div id="overviewTab" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Users</h3>
                            <div class="stat-value" id="totalUsers">0</div>
                            <div class="stat-change" id="userChange">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <h3>Active Listings</h3>
                            <div class="stat-value" id="activeListings">0</div>
                            <div class="stat-change" id="listingChange">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Orders</h3>
                            <div class="stat-value" id="totalOrders">0</div>
                            <div class="stat-change" id="orderChange">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <h3>Revenue</h3>
                            <div class="stat-value" id="totalRevenue">$0</div>
                            <div class="stat-change" id="revenueChange">Loading...</div>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h3>Recent Activity</h3>
                        <div id="activityList" class="activity-list">
                            <div class="loading-state">Loading activity...</div>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="usersTab" class="tab-content">
                    <div class="section-header">
                        <h3>User Management</h3>
                        <div class="search-box">
                            <input type="text" id="userSearch" placeholder="Search users...">
                            <button class="btn btn-secondary">Search</button>
                        </div>
                    </div>
                    
                    <div class="users-list">
                        <div class="list-header">
                            <span>User</span>
                            <span>Status</span>
                            <span>Listings</span>
                            <span>Actions</span>
                        </div>
                        <div id="usersList" class="list-content">
                            <div class="loading-state">Loading users...</div>
                        </div>
                    </div>
                </div>

                <!-- Listings Tab -->
                <div id="listingsTab" class="tab-content">
                    <div class="section-header">
                        <h3>Listing Moderation</h3>
                        <div class="filter-controls">
                            <select id="listingStatusFilter">
                                <option value="all">All Listings</option>
                                <option value="pending">Pending Review</option>
                                <option value="active">Active</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button class="btn btn-secondary" id="refreshListings">Refresh</button>
                        </div>
                    </div>
                    
                    <div class="listings-list">
                        <div class="list-header">
                            <span>Listing</span>
                            <span>Seller</span>
                            <span>Status</span>
                            <span>Actions</span>
                        </div>
                        <div id="moderationList" class="list-content">
                            <div class="loading-state">Loading listings...</div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="tab-content">
                    <div class="analytics-header">
                        <h3>System Analytics</h3>
                        <div class="date-filter">
                            <select id="analyticsRange">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h4>User Registrations</h4>
                            <div id="registrationsChart" class="chart-container">
                                <div class="loading-state">Loading chart...</div>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Listing Activity</h4>
                            <div id="listingsChart" class="chart-container">
                                <div class="loading-state">Loading chart...</div>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Transaction Volume</h4>
                            <div id="transactionsChart" class="chart-container">
                                <div class="loading-state">Loading chart...</div>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Category Distribution</h4>
                            <div id="categoriesChart" class="chart-container">
                                <div class="loading-state">Loading chart...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content">
                    <div class="settings-section">
                        <h3>System Configuration</h3>
                        <form id="systemSettings" class="settings-form">
                            <div class="form-group">
                                <label for="platformFee">Platform Fee (%)</label>
                                <input type="number" id="platformFee" name="platformFee" min="0" max="20" step="0.1">
                                <small>Percentage fee applied to all transactions</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="minWithdrawal">Minimum Withdrawal Amount</label>
                                <input type="number" id="minWithdrawal" name="minWithdrawal" min="1" step="1">
                                <small>Minimum amount required for seller withdrawals</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="autoApprove">Auto-approve Listings</label>
                                <select id="autoApprove" name="autoApprove">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                                <small>Automatically approve new listings without moderation</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="maxImages">Maximum Images per Listing</label>
                                <input type="number" id="maxImages" name="maxImages" min="1" max="10">
                                <small>Maximum number of images allowed per listing</small>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3>System Maintenance</h3>
                        <div class="maintenance-actions">
                            <button id="backupData" class="btn btn-secondary">Create Backup</button>
                            <button id="clearCache" class="btn btn-secondary">Clear Cache</button>
                            <button id="rebuildIndex" class="btn btn-secondary">Rebuild Search Index</button>
                            <button id="exportData" class="btn btn-secondary">Export Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="userDetailModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="userDetailContent">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <div id="notification" class="notification hidden"></div>

    <script src="../assets/js/core/api.js"></script>
    <script src="../assets/js/core/utils.js"></script>
    <script src="../assets/js/modules/auth.js"></script>
    <script src="../assets/js/modules/admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in and is admin
            if (!Auth.isLoggedIn()) {
                window.location.href = '../auth/login.html';
                return;
            }
            
            const user = Auth.getCurrentUser();
            if (user.role !== 'admin') {
                window.location.href = '../dashboard/index.html';
                return;
            }
            
            document.getElementById('userWelcome').textContent = `Welcome, ${user.username}`;
            
            // Logout functionality
            document.getElementById('logoutLink').addEventListener('click', function(e) {
                e.preventDefault();
                Auth.logout();
                window.location.href = '../auth/login.html';
            });
            
            // Initialize admin panel
            AdminPanel.init();
            
            // Tab navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    AdminPanel.switchTab(tab);
                });
            });
        });
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            setTimeout(() => {
                notification.className = 'notification hidden';
            }, 3000);
        }
    </script>
</body>
</html>