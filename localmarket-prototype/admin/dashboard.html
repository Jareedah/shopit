<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Shopit</title>
    
    <!-- Apple System Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SF Symbols Alternative - iOS-style icons -->
    <link href="https://cdn.jsdelivr.net/npm/phosphor-icons@1.4.2/src/css/icons.min.css" rel="stylesheet">
    
    <!-- Original CSS (preserved) -->
    <link rel="stylesheet" href="../assets/css/base/reset.css">
    <link rel="stylesheet" href="../assets/css/base/variables.css">
    <link rel="stylesheet" href="../assets/css/base/typography.css">
    <link rel="stylesheet" href="../assets/css/layout/header.css">
    <link rel="stylesheet" href="../assets/css/components/buttons.css">
    <link rel="stylesheet" href="../assets/css/components/forms.css">
    <link rel="stylesheet" href="../assets/css/components/cards.css">
    <link rel="stylesheet" href="../assets/css/pages/admin.css">
    
    <!-- Apple-Inspired Theme Coating - LOADED LAST FOR PRIORITY -->
    <link rel="stylesheet" href="../assets/css/themes/apple-inspired.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo">
                <i class="ph ph-shopping-bag" style="margin-right: 8px; vertical-align: middle;"></i>
                Shopit
            </h1>
            <nav class="navigation">
                <span class="nav-user">Admin Panel</span>
                <a href="../dashboard/index.html" class="nav-link">User Dashboard</a>
                <a href="../index.html" class="nav-link">Home</a>
                <span id="userWelcome"></span>
                <a href="#" id="logoutLink" class="nav-link">Logout</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="admin-header" style="text-align: center; padding: 40px 0; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: var(--apple-radius-lg); margin-bottom: 32px; box-shadow: var(--apple-shadow-medium);">
                <div style="color: var(--apple-red); font-size: 48px; margin-bottom: 16px;">
                    <i class="ph ph-shield-star"></i>
                </div>
                <h2 class="text-gradient-apple" style="font-size: var(--apple-font-size-title1); margin-bottom: 8px;">Administrator Dashboard</h2>
                <p style="color: var(--apple-text-secondary); font-size: var(--apple-font-size-body);">System overview and management tools</p>
            </div>

            <div class="admin-nav" style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 32px;">
                <button class="nav-btn active" data-tab="overview" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--apple-blue); color: white; border: none; border-radius: var(--apple-radius-full); font-weight: 600;">
                    <i class="ph ph-house"></i>
                    Overview
                </button>
                <button class="nav-btn" data-tab="users" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--apple-gray-light); color: var(--apple-text-secondary); border: none; border-radius: var(--apple-radius-full); font-weight: 600;">
                    <i class="ph ph-users"></i>
                    Users
                </button>
                <button class="nav-btn" data-tab="listings" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--apple-gray-light); color: var(--apple-text-secondary); border: none; border-radius: var(--apple-radius-full); font-weight: 600;">
                    <i class="ph ph-list-checks"></i>
                    Listings
                </button>
                <button class="nav-btn" data-tab="analytics" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--apple-gray-light); color: var(--apple-text-secondary); border: none; border-radius: var(--apple-radius-full); font-weight: 600;">
                    <i class="ph ph-chart-bar"></i>
                    Analytics
                </button>
                <button class="nav-btn" data-tab="settings" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--apple-gray-light); color: var(--apple-text-secondary); border: none; border-radius: var(--apple-radius-full); font-weight: 600;">
                    <i class="ph ph-gear"></i>
                    Settings
                </button>
            </div>

            <div class="admin-content">
                <!-- Overview Tab -->
                <div id="overviewTab" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Users</h3>
                            <div class="stat-value" id="totalUsers">0</div>
                            <div class="stat-change" id="userChange">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <h3>Active Listings</h3>
                            <div class="stat-value" id="activeListings">0</div>
                            <div class="stat-change" id="listingChange">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Orders</h3>
                            <div class="stat-value" id="totalOrders">0</div>
                            <div class="stat-change" id="orderChange">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <h3>Revenue</h3>
                            <div class="stat-value" id="totalRevenue">$0</div>
                            <div class="stat-change" id="revenueChange">Loading...</div>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h3>Recent Activity</h3>
                        <div id="activityList" class="activity-list">
                            <div class="loading-state">Loading activity...</div>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="usersTab" class="tab-content">
                    <div class="section-header">
                        <h3>User Management</h3>
                        <div class="search-box">
                            <input type="text" id="userSearch" placeholder="Search users...">
                            <button class="btn btn-secondary">Search</button>
                        </div>
                    </div>
                    
                    <div class="users-list">
                        <div class="list-header">
                            <span>User</span>
                            <span>Status</span>
                            <span>Listings</span>
                            <span>Actions</span>
                        </div>
                        <div id="usersList" class="list-content">
                            <div class="loading-state">Loading users...</div>
                        </div>
                    </div>
                </div>

                <!-- Listings Tab -->
                <div id="listingsTab" class="tab-content">
                    <div class="section-header">
                        <h3>Listing Moderation</h3>
                        <div class="filter-controls">
                            <select id="listingStatusFilter">
                                <option value="all">All Listings</option>
                                <option value="pending">Pending Review</option>
                                <option value="active">Active</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button class="btn btn-secondary" id="refreshListings">Refresh</button>
                        </div>
                    </div>
                    
                    <div class="listings-list">
                        <div class="list-header">
                            <span>Listing</span>
                            <span>Seller</span>
                            <span>Status</span>
                            <span>Actions</span>
                        </div>
                        <div id="moderationList" class="list-content">
                            <div class="loading-state">Loading listings...</div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="tab-content">
                    <div class="analytics-header" style="background: var(--apple-surface-elevated); border-radius: var(--apple-radius-lg); box-shadow: var(--apple-shadow-medium); padding: 24px; margin-bottom: 32px; text-align: center;">
                        <div style="color: var(--apple-purple); font-size: 48px; margin-bottom: 16px;">
                            <i class="ph ph-chart-line-up"></i>
                        </div>
                        <h3 style="color: var(--apple-text-primary); font-size: var(--apple-font-size-title2); margin-bottom: 8px;">System Analytics</h3>
                        <p style="color: var(--apple-text-secondary); font-size: var(--apple-font-size-body); margin-bottom: 8px;">Advanced insights and reporting tools</p>
                        <p style="color: var(--apple-text-tertiary); font-size: 13px; margin-bottom: 20px;">
                            <i class="ph ph-clock" style="margin-right: 4px;"></i>
                            Last updated: <span id="analyticsTimestamp">Loading...</span>
                        </p>
                        <div class="date-filter">
                            <select id="analyticsRange" style="border-radius: var(--apple-radius-md); border: 1px solid rgba(0,0,0,0.1); padding: 8px 12px; font-family: var(--apple-font-family);">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="charts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
                        <div class="chart-card" style="background: var(--apple-surface-elevated); border-radius: var(--apple-radius-lg); box-shadow: var(--apple-shadow-medium); padding: 24px; text-align: center;">
                            <h4 style="color: var(--apple-text-primary); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="ph ph-users" style="color: var(--apple-blue);"></i>
                                User Registrations
                            </h4>
                            <div id="registrationsChart" class="chart-container">
                                <div style="color: var(--apple-blue); font-size: 48px; margin-bottom: 16px;">
                                    <i class="ph ph-chart-line-up"></i>
                                </div>
                                <p style="color: var(--apple-text-secondary); font-size: 15px;">Advanced Analytics</p>
                                <p style="color: var(--apple-text-tertiary); font-size: 13px;">Coming Soon</p>
                            </div>
                        </div>
                        <div class="chart-card" style="background: var(--apple-surface-elevated); border-radius: var(--apple-radius-lg); box-shadow: var(--apple-shadow-medium); padding: 24px; text-align: center;">
                            <h4 style="color: var(--apple-text-primary); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="ph ph-list-checks" style="color: var(--apple-green);"></i>
                                Listing Activity
                            </h4>
                            <div id="listingsChart" class="chart-container">
                                <div style="color: var(--apple-green); font-size: 48px; margin-bottom: 16px;">
                                    <i class="ph ph-chart-bar"></i>
                                </div>
                                <p style="color: var(--apple-text-secondary); font-size: 15px;">Listing Trends</p>
                                <p style="color: var(--apple-text-tertiary); font-size: 13px;">Coming Soon</p>
                            </div>
                        </div>
                        <div class="chart-card" style="background: var(--apple-surface-elevated); border-radius: var(--apple-radius-lg); box-shadow: var(--apple-shadow-medium); padding: 24px; text-align: center;">
                            <h4 style="color: var(--apple-text-primary); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="ph ph-currency-dollar" style="color: var(--apple-orange);"></i>
                                Transaction Volume
                            </h4>
                            <div id="transactionsChart" class="chart-container">
                                <div style="color: var(--apple-orange); font-size: 48px; margin-bottom: 16px;">
                                    <i class="ph ph-chart-pie"></i>
                                </div>
                                <p style="color: var(--apple-text-secondary); font-size: 15px;">Revenue Analytics</p>
                                <p style="color: var(--apple-text-tertiary); font-size: 13px;">Coming Soon</p>
                            </div>
                        </div>
                        <div class="chart-card" style="background: var(--apple-surface-elevated); border-radius: var(--apple-radius-lg); box-shadow: var(--apple-shadow-medium); padding: 24px; text-align: center;">
                            <h4 style="color: var(--apple-text-primary); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="ph ph-tag" style="color: var(--apple-purple);"></i>
                                Category Distribution
                            </h4>
                            <div id="categoriesChart" class="chart-container">
                                <div style="color: var(--apple-purple); font-size: 48px; margin-bottom: 16px;">
                                    <i class="ph ph-chart-donut"></i>
                                </div>
                                <p style="color: var(--apple-text-secondary); font-size: 15px;">Category Insights</p>
                                <p style="color: var(--apple-text-tertiary); font-size: 13px;">Coming Soon</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content">
                    <div class="settings-section">
                        <h3>System Configuration</h3>
                        <form id="systemSettings" class="settings-form">
                            <div class="form-group">
                                <label for="platformFee">Platform Fee (%)</label>
                                <input type="number" id="platformFee" name="platformFee" min="0" max="20" step="0.1">
                                <small>Percentage fee applied to all transactions</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="minWithdrawal">Minimum Withdrawal Amount</label>
                                <input type="number" id="minWithdrawal" name="minWithdrawal" min="1" step="1">
                                <small>Minimum amount required for seller withdrawals</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="autoApprove">Auto-approve Listings</label>
                                <select id="autoApprove" name="autoApprove">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                                <small>Automatically approve new listings without moderation</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="maxImages">Maximum Images per Listing</label>
                                <input type="number" id="maxImages" name="maxImages" min="1" max="10">
                                <small>Maximum number of images allowed per listing</small>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3>System Maintenance</h3>
                        <div class="maintenance-actions">
                            <button id="backupData" class="btn btn-secondary">Create Backup</button>
                            <button id="clearCache" class="btn btn-secondary">Clear Cache</button>
                            <button id="rebuildIndex" class="btn btn-secondary">Rebuild Search Index</button>
                            <button id="exportData" class="btn btn-secondary">Export Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="userDetailModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="userDetailContent">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <div id="notification" class="notification hidden"></div>

    <script src="../assets/js/core/api.js"></script>
    <script src="../assets/js/core/utils.js"></script>
    <script src="../assets/js/modules/auth.js"></script>
    <script src="../assets/js/modules/admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in and is admin
            if (!Auth.isLoggedIn()) {
                window.location.href = '../auth/login.html';
                return;
            }
            
            const user = Auth.getCurrentUser();
            if (user.role !== 'admin') {
                window.location.href = '../dashboard/index.html';
                return;
            }
            
            document.getElementById('userWelcome').textContent = `Welcome, ${user.username}`;
            
            // Logout functionality
            document.getElementById('logoutLink').addEventListener('click', function(e) {
                e.preventDefault();
                Auth.logout();
                window.location.href = '../auth/login.html';
            });
            
            // Initialize admin panel
            AdminPanel.init();
            
            // Tab navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    AdminPanel.switchTab(tab);
                });
            });
        });
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            setTimeout(() => {
                notification.className = 'notification hidden';
            }, 3000);
        }

        // Update analytics timestamp
        function updateAnalyticsTimestamp() {
            const timestampElement = document.getElementById('analyticsTimestamp');
            if (timestampElement) {
                const now = new Date();
                timestampElement.textContent = now.toLocaleString();
            }
        }

        // Initialize timestamp when analytics tab is shown
        document.addEventListener('DOMContentLoaded', function() {
            updateAnalyticsTimestamp();
            
            // Update timestamp when analytics tab is clicked
            const analyticsTabBtn = document.querySelector('[onclick="showTab(\'analytics\')"]');
            if (analyticsTabBtn) {
                analyticsTabBtn.addEventListener('click', updateAnalyticsTimestamp);
            }

            // Wire up maintenance buttons
            const backupBtn = document.getElementById('backupData');
            if (backupBtn) {
                backupBtn.addEventListener('click', createBackup);
            }

            const clearCacheBtn = document.getElementById('clearCache');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', clearCache);
            }

            const rebuildIndexBtn = document.getElementById('rebuildIndex');
            if (rebuildIndexBtn) {
                rebuildIndexBtn.addEventListener('click', rebuildIndex);
            }

            const exportDataBtn = document.getElementById('exportData');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', exportData);
            }
        });

        // Maintenance functions
        async function createBackup() {
            try {
                showNotification('Creating backup...', 'info');
                
                const response = await fetch('../api/admin/backup.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `shopit-backup-${new Date().toISOString().split('T')[0]}.zip`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    showNotification('Backup created and downloaded successfully!', 'success');
                } else {
                    throw new Error('Backup failed');
                }
            } catch (error) {
                showNotification('Error creating backup: ' + error.message, 'error');
            }
        }

        function clearCache() {
            showNotification('Cache clearing feature coming soon...', 'info');
        }

        function rebuildIndex() {
            showNotification('Search index rebuilding feature coming soon...', 'info');
        }

        function exportData() {
            showNotification('Data export feature coming soon...', 'info');
        }
    </script>

    <!-- Apple-Inspired Mobile Navigation -->
    <nav class="apple-bottom-nav">
        <a href="../index.html" class="apple-nav-item">
            <div class="apple-nav-icon">
                <i class="ph ph-house"></i>
            </div>
            Home
        </a>
        <a href="../search/index.html" class="apple-nav-item">
            <div class="apple-nav-icon">
                <i class="ph ph-magnifying-glass"></i>
            </div>
            Browse
        </a>
        <a href="../listings/create.html" class="apple-nav-item">
            <div class="apple-nav-icon">
                <i class="ph ph-plus-circle"></i>
            </div>
            Sell
        </a>
        <a href="../dashboard/index.html" class="apple-nav-item">
            <div class="apple-nav-icon">
                <i class="ph ph-squares-four"></i>
            </div>
            Dashboard
        </a>
        <a href="dashboard.html" class="apple-nav-item active">
            <div class="apple-nav-icon">
                <i class="ph ph-shield-star"></i>
            </div>
            Admin
        </a>
    </nav>

    <!-- Apple-Inspired Floating Action Button -->
    <button class="apple-fab" onclick="window.location.href='../dashboard/index.html'" title="User Dashboard">
        <i class="ph ph-user" style="font-size: 24px;"></i>
    </button>
</body>
</html>